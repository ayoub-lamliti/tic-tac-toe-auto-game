let c=3;const B="<div class='square'></div>";let a=null,u=null,P=null,O=null,g=[],y=[],f=g,C=[],h=[],q=[],m=[],b=[],E=[];const o="x",l="o";let n={winner:{[o]:0,[l]:0},pointXO:{[o]:[],[l]:[]},pointPossibilitiesCpu:{[o]:[],[l]:[]},possibilityThreePointEmpty:{possibility:[]},possibilitiesThreePointNotEmpty:[],start:!0,player_now:u,gameOver:!1,playCpu:!1,playNotEasy:!1};const W=document.querySelector("#increment"),H=document.querySelector("#decrement"),p=document.querySelector("#quantity");W.addEventListener("click",()=>{parseInt(p.value)<15&&(p.value=parseInt(p.value)+2,c=parseInt(p.value))});H.addEventListener("click",()=>{parseInt(p.value)>3&&(p.value=parseInt(p.value)-2,c=parseInt(p.value))});document.getElementById("button").addEventListener("click",()=>{document.querySelector('input[name="player"]:checked').value===o?(u=o,k(o)):(u=l,k(l)),P=u===o?l:o,document.querySelector("#header-and-board-wrapper").classList.add("d-block"),document.querySelector(".container").classList.add("d-none"),G()});document.getElementById("checkAuto").addEventListener("change",e=>{n.playCpu=e.target.checked,n.playCpu?document.querySelector(".checkHardOrEasy").classList.add("d-block-force"):document.querySelector(".checkHardOrEasy").classList.remove("d-block-force")});document.getElementById("checkHardOrEasy").addEventListener("change",e=>{n.playNotEasy=e.target.checked});const G=()=>{let e="";const t=c*c;for(let r=0;r<t;r++)e+=B;document.querySelector(".grid-container").style=`grid-template-columns: ${c}fr repeat(${c-1}, auto);`,document.querySelector(".grid-container").innerHTML=e,c>3&&document.querySelectorAll(".square").forEach(r=>r.classList.add("square-countBig")),a=document.querySelectorAll(".square"),y=Array.from({length:t},(r,s)=>s),q=Array.from({length:c},(r,s)=>[]),m=c,y.forEach(r=>{let s=m-c;y.slice(s,m).length&&h.push(y.slice(s,m)),m+=c}),h.forEach(r=>{let s=0;r.forEach(d=>{q[s].push(d),s=s+1})});let i=0;h.forEach(r=>{b.push(r[i]),i=i+1}),i=c-1,h.forEach(r=>{E.push(r[i]),i=i-1}),O=b.filter(r=>E.includes(r))[0],g.push(...h,...q,b,E),f=g,C=[b[0],E[0],E.slice(-1)[0],b.slice(-1)[0]],a.forEach((r,s)=>{r.setAttribute("cell",s),r.addEventListener("click",d=>{r.getAttribute("player")||(v(s),n.playCpu&&!n.gameOver&&K(),T())})})},M=()=>{const e=u===o?l:o,t=n.start?u:e;return n.start=!n.start,t},X=(e=!1)=>{f.forEach(t=>{t.every(i=>x(i,o))&&(S(t,o),n.winner={...n.winner,[o]:n.winner.x+1}),t.every(i=>x(i,l))&&(S(t,l),n.winner={...n.winner,[l]:n.winner.o+1}),e&&S([],"we drew")})},S=(e,t)=>{e.length&&(u===t?t="winner":t="loser",R(e,t),t="You "+t),U(t),j(),n.gameOver=!0},T=()=>{document.getElementById("countWinnerX").textContent=n.winner.x,document.getElementById("countWinnerO").textContent=n.winner.o},U=e=>{alertify.confirm("Winner !!",e,t=>w(),t=>w())},R=(e,t)=>{e.forEach(i=>{a[i].classList.add(t)})},j=()=>{a.forEach(e=>{e.removeEventListener("click",t=>{})})},x=(e,t)=>a[e].getAttribute("player")===t,v=e=>{const t=M();n.player_now=t,$(t,e),t===o?(a[e].classList.add(o),k(l)):(a[e].classList.add(l),k(o)),a[e].setAttribute("player",t),a[e].innerText=t,a[e].classList.add("active"),X()},k=e=>{document.getElementById("turn").textContent=e.toUpperCase()},$=(e,t)=>{e===o?n.pointXO[o].push(t):n.pointXO[l].push(t),z(e),Y()},Y=()=>{const e=f.filter(t=>t.every(i=>n.pointXO[o].every(r=>r!==i)&&n.pointXO[l].every(r=>r!==i)));n.possibilityThreePointEmpty={...n.possibilityThreePointEmpty,possibility:e}},z=e=>{n.pointPossibilitiesCpu={...n.pointPossibilitiesCpu,[e]:D(n.pointXO[e])}},D=e=>{if(e.length>1){const t=c-1,i=1;let r={};return f.map((s,d)=>{r={...r,[d]:[]},s.some(L=>{e.includes(L)&&r[d].push(L)})}),Object.values(r).filter(s=>s.length>i&&s.length<=t)}return[e]},F=()=>({[o]:I(o,l),[l]:I(l,o)}),I=(e,t)=>f.filter(i=>n.pointPossibilitiesCpu[e].some(r=>r.every(s=>i.includes(s)))).filter(i=>n.pointXO[t].every(r=>!i.includes(r))),J=()=>{n.possibilitiesThreePointNotEmpty=f.filter(e=>n.possibilityThreePointEmpty.possibility.every(t=>!e.every(i=>t.includes(i))))},K=()=>{J(),V(),Q()},Q=()=>{const e=F(),t=A(e,u),i=A(e,P);n.pointXO[n.player_now].length>1&&n.player_now!==P&&(t.possibilitiesWinner?t.point[0].difference.length>1?i.possibilitiesWinner?v(i.point[0].difference[0]):_():v(t.point[0].difference[0]):i.possibilitiesWinner?v(i.point[0].difference[0]):_())},_=()=>{const e=ee();e!==void 0?v(e):X(!0)},A=(e,t)=>{let i={[t]:[]};return e[t].forEach(r=>{n.pointPossibilitiesCpu[t].some(s=>s.every(d=>r.includes(d))&&i[t].push({i:s,item:r,difference:r.filter(d=>!s.includes(d))}))}),{player:[t][0],possibilitiesWinner:i[t].length,point:i[t]}},V=()=>{if(n.pointXO[n.player_now].length===1){let e;n.pointXO[n.player_now][0]!==O?e=O:e=Z(),v(e)}},Z=()=>{let e=null;n.playNotEasy?e=C:e=y.filter(i=>n.pointXO[n.player_now][0]!==i);const t=Math.floor(Math.random()*e.length);return e[t]},ee=()=>{const e=y.filter(i=>n.pointXO[o].every(r=>r!==i)&&n.pointXO[l].every(r=>r!==i)),t=Math.floor(Math.random()*e.length);return e[t]},w=()=>{a.forEach(e=>{e.innerText="",e.removeAttribute("player"),e.classList.remove("winner","loser","active","x","o")}),k(u),n={...n,pointXO:{[o]:[],[l]:[]},pointPossibilitiesCpu:{[o]:[],[l]:[]},possibilityThreePointEmpty:{possibility:[]},possibilitiesThreePointNotEmpty:[],start:!0,player_now:u,gameOver:!1}},N=()=>{w(),n.winner={[o]:0,[l]:0},T()},te=()=>{N(),document.querySelector("#header-and-board-wrapper").classList.remove("d-block"),document.querySelector(".container").classList.remove("d-none"),P=null,u=null,document.querySelector("#checkAuto").checked&&document.querySelector("#checkAuto").click(),document.querySelector("#checkHardOrEasy").checked&&document.querySelector("#checkHardOrEasy").click(),p.value=3,c=3,a=null,u=null,P=null,O=null,g=[],y=[],f=g,C=[],h=[],q=[],m=[],b=[],E=[]};document.querySelector(".btn-resetAll").addEventListener("click",()=>N());document.querySelector(".btn-exitGame").addEventListener("click",()=>te());
